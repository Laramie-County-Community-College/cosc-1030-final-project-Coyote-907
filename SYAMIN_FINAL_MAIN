import random

def simulate_3pt_shot(your_3pt_pct, score_difference, prob_win_overtime):
    """Simulates a single trial of taking a 3-pointer."""
    points_scored = 0
    if random.random() < your_3pt_pct:
        points_scored = 3
    
    final_score_diff = score_difference + points_scored
    if final_score_diff > 0:
        return 1, points_scored # Win, points scored
    elif final_score_diff < 0:
        return 0, points_scored # Loss, points scored
    else:
        # Overtime
        if random.random() < prob_win_overtime:
            return 1, points_scored # Win in OT
        else:
            return 0, points_scored # Loss in OT

def simulate_foul_opponent(score_difference, opp_ft_pct, prob_win_overtime, prob_off_rebound):
    """
    Simulates a single trial of fouling the opponent, including
    making/missing free throws and a potential offensive rebound.
    """
    ft_made = 0
    
    # Simulate the first free throw (randomized outcome)
    if random.random() < opp_ft_pct:
        ft_made += 1
    
    # Simulate the second free throw (randomized outcome)
    if random.random() < opp_ft_pct:
        ft_made += 1
    
    # Update score difference
    final_score_diff = score_difference - ft_made # Opponent scores points

    # Determine game outcome based on final score difference
    if final_score_diff > 0:
        return 1, 0 # Win, 0 points scored by your team
    elif final_score_diff < 0:
        return 0, 0 # Loss, 0 points scored by your team
    else:
        # Overtime
        if random.random() < prob_win_overtime:
            return 1, 0 # Win in OT
        else:
            return 0, 0 # Loss in OT

def run_simulation_for_strategy(num_trials, strategy_choice, params):
    """
    Runs a Monte Carlo simulation for a specified strategy.
    """
    wins = 0
    total_points = 0
    
    for _ in range(num_trials):
        if strategy_choice == "3pt":
            win, points = simulate_3pt_shot(params['your_3pt_pct'], params['score_difference'], params['prob_win_overtime'])
        elif strategy_choice == "foul":
            win, points = simulate_foul_opponent(
                params['score_difference'],
                params['opp_ft_pct'],
                params['prob_win_overtime'],
                params['prob_off_rebound']
            )

        wins += win
        total_points += points

    win_pct = (wins / num_trials) * 100
    avg_points = total_points / num_trials

    return win_pct, avg_points

# --- Main script ---
# Define parameters
PARAMETERS = {
    'your_3pt_pct': 0.35,      # 35%
    'your_2pt_pct': 0.50,      # 50%
    'opp_ft_pct': 0.70,        # 70%
    'prob_off_rebound': 0.30,  # 30%
    'prob_win_overtime': 0.50, # 50%
    'score_difference': -2,    # Your team is down by 2 points
    'time_left': 0.05          # 0.05 minutes remaining
}
NUM_SIMULATIONS = 100000 # Number of trials to run for each strategy

print(f"Simulation Parameters:")
print(f"  Your 3-point percentage: {PARAMETERS['your_3pt_pct'] * 100}%")
print(f"  Opponent FT percentage: {PARAMETERS['opp_ft_pct'] * 100}%")
print(f"  Current score difference (You - Opponent): {PARAMETERS['score_difference']}")
print(f"  Number of simulations per strategy: {NUM_SIMULATIONS:,}")
print("-" * 40)

# Run simulations for both strategies
print("Running simulations for both strategies...")
results_3pt_pct, results_3pt_avg_points = run_simulation_for_strategy(NUM_SIMULATIONS, "3pt", PARAMETERS)
results_foul_pct, results_foul_avg_points = run_simulation_for_strategy(NUM_SIMULATIONS, "foul", PARAMETERS)

# Display results
print("-" * 40)
print(f"Results:")
print("-" * 40)
print(f"Strategy: Take a 3-pointer")
print(f"  Win Percentage: {results_3pt_pct:.2f}%")
print(f"  Average Points Scored in Scenario: {results_3pt_avg_points:.2f}")
print("-" * 40)
print(f"Strategy: Foul Opponent")
print(f"  Win Percentage: {results_foul_pct:.2f}%")
print(f"  Average Points Scored in Scenario: {results_foul_avg_points:.2f}")
print("-" * 40)

# Decision making based on results
if results_3pt_pct > results_foul_pct:
    print(f"Conclusion: Taking a 3-pointer is the better strategy to win this game ({results_3pt_pct:.2f}% win rate vs. {results_foul_pct:.2f}%).")
elif results_foul_pct > results_3pt_pct:
    print(f"Conclusion: Fouling the opponent is the better strategy to win this game ({results_foul_pct:.2f}% win rate vs. {results_3pt_pct:.2f}%).")
else:
    print("Conclusion: Both strategies yield approximately the same win percentage.")
